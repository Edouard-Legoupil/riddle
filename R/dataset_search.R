# WARNING - Generated by {fusen} from /dev/ridlle_dev.Rmd: do not edit by hand

#' Searches for datasets and resources satisfying a given criteria.
#'
#' @name search
#'
#' @param q,query The search query.
#' @param rows The maximum number of matching rows (datasets) to return. 
#'              (optional, default: 10, upper limit: 1000)
#' @param start The offset in the complete result for where the set of returned 
#'               datasets should begin.
#'
#' @importFrom purrr is_empty pmap
#' @importFrom tibble tibble
#' @importFrom tidyselect vars_select_helpers
#' @importFrom dplyr mutate across
#' 
#' @return A tibble with the search results.
#' @export
#' @examples
#' #-----
#' # Test search in prod
#' Sys.unsetenv("USE_UAT")
#' p <- riddle::dataset_search(q = "cbi")
#' p
#' p$id
#' 
#' 
#' 
#' 
dataset_search <- function(q = NULL, rows = NULL, start = NULL) {
  r <- ridl(action ="package_search", 
            !!!(as.list(match.call()[-1])) )$results

  if (purrr::is_empty(r)) {
    r <- tibble::tibble()
    
  } else {  
    r %>%
    dplyr::mutate(dplyr::across(tidyselect::vars_select_helpers$where(is.data.frame),
                                ~purrr::pmap(., ~tibble::tibble(...)))) %>%
    tibble::as_tibble() -> r
    }
  return(r)
}

