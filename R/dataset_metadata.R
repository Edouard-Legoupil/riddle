# WARNING - Generated by {fusen} from /dev/ridlle_dev.Rmd: do not edit by hand

#' Convenience function to record dataset metadata
#'
#' @description This function create a metadata object used to then interact with the API
#'
#' @details All arguments are of type character. Fields `tag_string`, `data_collector`, `keywords`, `sampling_procedure`, and `operational_purpose_of_data` accept vectors of multiple values.
#'
#' Fields marked with a (*) are required for \code{\link{dataset_create()}} and \code{\link{dataset_update()}} operations.
#'
#' @param title Title(*) - Make sure to include: 'Survey name/title', 'Location', 'Country', and 'Year(s)' in the order indicated.
#' @param name URL(*) - The canonical name of the dataset, eg. my-dataset.
#' @param short_title Short title - eg. Short title for the project.
#' @param notes Description(*) - Some useful notes about the data. Please include the number of observations.
#' @param tag_string Tags - eg. economy, mental health, government.
#' @param url Project URL - Website URL associated with this data project (if applicable).
#' @param owner_org Data container(*) - Use the canonical name for the container.
#' @param geographies  defaults is geographies - pulling from a webservice from geoserver
#' @param private Visibility (Private/Public).
#' @param visibility Internal Access Level(*). Allowed values: `restricted` (Private), `public` (Internally Visible).
#' @param external_access_level External access level(*). Allowed values: `not_available` (Not available), `direct_access` (Direct access), `public_use` (Public use), `licensed_use` (Licensed use), `data_enclave` (Data enclave), `open_access` (Open access).
#' @param data_sensitivity Data sensitivity - Apply to both Anonymized and Personally identifiable data. Allowed values: `yes` (Yes), `no` (No).
#' @param original_id Original ID - If the dataset already has an ID from the source org, DDI, etc...
#' @param data_collector Data Collector(*) - Which organization owns / collected the data. Multiple values are allowed.
#' @param date_range_start Date collection first date - Use dd/mm/yyyy format.
#' @param date_range_end Date collection last date - Use dd/mm/yyyy format.
#' @param keywords Topic classifications(*) - Tags useful for searching for the datasets. Multiple values are allowed. See \code{\link{keywords}}
#' @param unit_of_measurement Unit of measurement(*) - Unit of measurement / observation for the dataset.
#' @param sampling_procedure Sampling Procedure. Multiple values are allowed. Allowed values: `total_universe_complete_enumeration` (Total universe/Complete enumeration), `probability_simple_random` (Probability: Simple random), `probability_systematic_random` (Probability: Systematic random), `probability_stratified` (Probability: Stratified), `probability_stratified_proportional` (Probability: Stratified: Proportional), `probability_stratified_disproportional` (Probability: Stratified: Disproportional), `probability_cluster` (Probability: Cluster), `probability_cluster_simple_random` (Probability: Cluster: Simple random ), `probability_cluster_stratified_random` (Probability: Cluster: Stratified random), `probability_multistage` (Probability: Multistage), `nonprobability` (Non-probability), `nonprobability_availability` (Non-probability: Availability), `nonprobability_purposive` (Non-probability: Purposive), `nonprobability_quota` (Non-probability: Quota), `nonprobability_respondentassisted` (Non-probability: Respondent-assisted), `mixed_probability_nonprobability` (Mixed probability and non-probability), `other_other` (Use if the sampling procedure is known, but not found in the list..).
#' @param operational_purpose_of_data Operational purpose of data - Classification of the type of data contained in the file. Multiple values are allowed. Allowed values: `participatory_assessments` (Participatory assessments), `baseline_household_survey` (Baseline Household Survey), `rapid_needs_assessment` (Rapid Needs Assessment), `protection_monitoring` (Protection Monitoring), `programme_monitoring` (Programme monitoring), `population_data` (Population Data), `cartography` (Cartography, Infrastructure & GIS).
#' @param `hxl-ated` HXL-ated.
#' @param process_status Dataset Process Status. Allowed values: `raw` (Raw-Uncleaned), `cleaned` (Cleaned Only), `anonymized` (Cleaned & Anonymized).
#' @param identifiability Identifiability. Allowd values: `personally_identifiable` (Personally identifiable), `anonymized_enclave` (Anonymized 1st level: Data Enclave - only removed direct identifiers), `anonymized_scientific` (Anonymized 2st level: Scientific Use File (SUF)), `anonymized_public` (Anonymized 3rd level: Public Use File (PUF)).
#' @param geog_coverage Geographic Coverage - eg. National coverage, or name of the area, etc.
#' @param data_collection_technique Data collection technique(*). Allowed values: `nf` (Not specified), `f2f` (Face-to-face interview), `capi` (Face-to-face interview: Computerised), `cami` (Face-to-face interview: Mobile), `papi` (Face-to-face interview: Paper-and-pencil), `tri` (Telephone interview), `eri` (E-mail interview), `wri` (Web-based interview: audio-visual technology enabling the interviewer(s) and interviewee(s) to communicate in real time), `easi` (Self-administered questionnaire: E-mail), `pasi` (Self-administered questionnaire: Paper), `sasi` (Self-administered questionnaire: SMS/MMS), `casi` (Self-administered questionnaire: Computer-assisted), `cawi` (Self-administered questionnaire: Web-based), `foc` (Face-to-face focus group), `tfoc` (Telephone focus group), `obs` (Observation), `oth` (Other).
#' @param linked_datasets Linked Datasets - Links to other RIDL datasets. It supports multiple selections.
#' @param archived Archived(*) - Allows users to indicate if the dataset is archived or active. Allowed values: `False` (No), `True` (Yes).
#' @param admin_notes Admin Notes - General. You can use Markdown formatting here.
#' @param sampling_procedure_notes Admin Notes - Sampling Procedure. You can use Markdown formatting here.
#' @param response_rate_notes Admin Notes - Response Rate. You can use Markdown formatting here.
#' @param data_collection_notes Admin Notes - Data Collection. You can use Markdown formatting here.
#' @param weight_notes Admin Notes - Weighting. You can use Markdown formatting here.
#' @param clean_ops_notes Admin Notes - Cleaning. You can use Markdown formatting here.
#' @param data_accs_notes Admin Notes - Access authority. You can use Markdown formatting here.
#' @param ddi DDI.
#' @param ... ignored.
#' 
#' @importFrom purrr discard modify_if negate  
#' @importFrom rlang is_empty is_atomic
#' @importFrom tibble as_tibble
#'
#' @return A list with the provided metadata.
#' @export
#' @examples
#' m <- dataset_metadata(title = "Motor Trend Car Road Tests",
#'                       name = "mtcars",
#'                       notes = "The data was extracted from the 1974 Motor Trend 
#'                       US magazine, and comprises fuel consumption and 10 aspects
#'                       of automobile design and performance for 32 automobiles 
#'                       (1973â€“74 models).",
#'                       owner_org = "exercise-container",
#'                       visibility = "public",
#'                       geographies = "UNSPECIFIED",
#'                       external_access_level = "open_access",
#'                       data_collector = "Motor Trend",
#'                       keywords = keywords[c("Environment", "Other")],
#'                       unit_of_measurement = "car",
#'                       data_collection_technique = "oth",
#'                       archived = "False")
#' m
#' 
dataset_metadata <- function(title = NULL,
                             name = NULL,
                             short_title = NULL,
                             notes = NULL,
                             tag_string  = NULL,
                             url = NULL,
                             owner_org = NULL,
                             geographies = "UNSPECIFIED",
                             private = NULL,
                             visibility = NULL,
                             external_access_level  = NULL,
                             data_sensitivity = NULL,
                             original_id = NULL,
                             data_collector = NULL,
                             date_range_start = NULL,
                             date_range_end = NULL,
                             keywords = NULL,
                             unit_of_measurement = NULL,
                             sampling_procedure = NULL,
                             operational_purpose_of_data = NULL,
                             `hxl-ated` = NULL,
                             process_status = NULL,
                             identifiability = NULL,
                             geog_coverage = NULL,
                             data_collection_technique = NULL,
                             linked_datasets = NULL,
                             archived = NULL,
                             admin_notes = NULL,
                             sampling_procedure_notes = NULL,
                             response_rate_notes = NULL,
                             data_collection_notes = NULL,
                             weight_notes = NULL,
                             clean_ops_notes = NULL,
                             data_accs_notes = NULL,
                             ddi = NULL,
                             ...) {
  list(title = title,
       name = name,
       short_title = short_title,
       notes = notes,
       tag_string = tag_string,
       url = url,
       owner_org = owner_org,
       private = private,
       visibility = visibility,
       external_access_level = external_access_level,
       data_sensitivity = data_sensitivity,
       original_id = original_id,
       data_collector = data_collector,
       date_range_start = date_range_start,
       date_range_end = date_range_end,
       keywords = keywords,
       unit_of_measurement = unit_of_measurement,
       sampling_procedure = sampling_procedure,
       operational_purpose_of_data = operational_purpose_of_data,
       `hxl-ated` = `hxl-ated`,
       process_status = process_status,
       identifiability = identifiability,
       geographies = geographies,
       geog_coverage = geog_coverage,
       data_collection_technique = data_collection_technique,
       linked_datasets = linked_datasets,
       archived = archived,
       admin_notes = admin_notes,
       sampling_procedure_notes = sampling_procedure_notes,
       response_rate_notes = response_rate_notes,
       data_collection_notes = data_collection_notes,
       weight_notes = weight_notes,
       clean_ops_notes = clean_ops_notes,
       data_accs_notes = data_accs_notes,
       ddi = ddi) %>%
    purrr::discard(purrr::is_empty)
}

# Helper function to package API results as a  tibble
dataset_tibblify <- function(x) {
  x %>%
    purrr::modify_if(rlang::is_empty, ~NA) %>%
    purrr::modify_if(rlang::is_list, tibble::as_tibble) %>%
    purrr::modify_if(purrr::negate(rlang::is_atomic), list) %>%
    purrr::modify_if(~rlang::is_atomic(.) & length(.) > 1, list) %>%
    tibble::as_tibble()
}
